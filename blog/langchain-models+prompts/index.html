<!doctype html>
<html lang="en-us">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title> LangChain Models&#43;Prompts - RainPot Blog </title>
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="referrer" content="no-referrer">
    <meta name="description" content="LangChain学习" />
    <meta property="og:site_name" content="RainPot Blog" />
    <meta property="og:locale" content="en_US" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="/blog/langchain-models&#43;prompts/" />
    <meta property="og:title" content="LangChain Models&#43;Prompts" />
    <meta property="og:image" content="/" />
    <meta property="og:description" content="LangChain学习" />
    <meta name="twitter:card" content="summary_large_image" />
    
    <meta name="twitter:title" content="LangChain Models&#43;Prompts" />
    <meta name="twitter:description" content="LangChain学习" />
    

    <meta name="twitter:image" content="/" />
    <link rel="canonical" href="/blog/langchain-models&#43;prompts/">
    
    <link rel="stylesheet" href="/css/site.min.css" />
    <link rel="stylesheet" href="/css/custom.css" />

    
    
    <link href="/index.xml" rel="alternate" type="application/rss+xml" title="RainPot Blog" />
    
  </head>

  <body>
    
<div class="mt-xl header">
  <header>
    <div class="container">
      <div class="row justify-content-center">
	<div class="col-auto">
	  <a href="/" style="display: contents">
	    <h1 class="name text-center">RainPot Blog</h1>
	  </a>
	</div>
      </div>
      <div class="row justify-content-center">
	<section class="nav  justify-content-center">
	  <ul>
	    
	    <li class="nav-item justify-content-center mx-auto"> 
	      <a class="nav-link" href="/">
		
		Home
	      </a>
	    </li>
	    
	    <li class="nav-item justify-content-center mx-auto"> 
	      <a class="nav-link" href="/blog/">
		
		Articles
	      </a>
	    </li>
	    
	    <li class="nav-item justify-content-center mx-auto"> 
	      <a class="nav-link" href="/about">
		
		About
	      </a>
	    </li>
	    
	    <li class="nav-item justify-content-center mx-auto"> 
	      <a class="nav-link" href="https://github.com/RainPot">
		
		Subscribe
	      </a>
	    </li>
	    
	    
	  </ul>
	</section>
      </div>
    </div>
  </header>
</div>

<div class="content">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-sm-12 col-lg-8">
	<h1 class="mx-0 mx-md-4 blog-post-title">LangChain Models&#43;Prompts</h1>
	<div class="meta-data meta">
	  
	  
	  
	  <span class="author meta-data" title="Cynicsss">
	    Cynicsss
	  </span>
	  
	  
	  <span class="date middot meta-data" title='Sat Apr 8 2023 00:00:00 UTC'>
	    2023-04-08
	  </span>
	  <span class="reading-time middot meta-data">
	    10 min read
	  </span>
	  
	  <a class="middot meta-data" href="/blog/langchain-models&#43;prompts/">Permalink</a>
	  <div class="d-none d-md-inline tags">
	    <ul class="list-unstyled d-inline">
	      
	    </ul>
	  </div>
	</div>
	<div class="markdown blog-post-content">
	  <p>[TOC]</p>
<h2 id="1安装">1.安装</h2>
<pre tabindex="0"><code>pip install langchain
</code></pre><hr>
<h2 id="2环境配置">2.环境配置</h2>
<p>For this example, we will be using OpenAI’s APIs, so we will first need to install their SDK:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>pip install openai
</span></span></code></pre></div><p>We will then need to set the environment variable in the terminal.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">OPENAI_API_KEY</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;...&#34;</span>
</span></span></code></pre></div><p>Alternatively, you could do this from inside the Jupyter notebook (or Python script):</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">os</span>
</span></span><span style="display:flex;"><span><span style="color:#000">os</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">environ</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;OPENAI_API_KEY&#34;</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;...&#34;</span>
</span></span></code></pre></div><hr>
<h2 id="3简单llm预测">3.简单LLM预测</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">langchain.llms</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">OpenAI</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">llm</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">OpenAI</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">temperature</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">0.9</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">text</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;What would be a good company name for a company that makes colorful socks?&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">llm</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">text</span><span style="color:#000;font-weight:bold">))</span>
</span></span></code></pre></div><p>结果：<br>
<code>Feetful of Fun</code></p>
<hr>
<h2 id="4prompt-templates">4.Prompt Templates</h2>
<h4 id="41-简单示例">4.1 简单示例：</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">langchain.prompts</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">PromptTemplate</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">prompt</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">PromptTemplate</span><span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">input_variables</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;product&#34;</span><span style="color:#000;font-weight:bold">],</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">template</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;What is a good name for a company that makes </span><span style="color:#4e9a06">{product}</span><span style="color:#4e9a06">?&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">prompt</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">format</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">product</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;colorful socks&#34;</span><span style="color:#000;font-weight:bold">))</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>What is a good name <span style="color:#204a87;font-weight:bold">for</span> a company that makes colorful socks?
</span></span></code></pre></div><hr>
<h4 id="42-多个可变参数示例">4.2 多个可变参数示例：</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">langchain</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">PromptTemplate</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># 无输入</span>
</span></span><span style="display:flex;"><span><span style="color:#000">no_input_prompt</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">PromptTemplate</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">input_variables</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">[],</span> <span style="color:#000">template</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;Tell me a joke.&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">no_input_prompt</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">format</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># -&gt; &#34;Tell me a joke.&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># 只有一个输入</span>
</span></span><span style="display:flex;"><span><span style="color:#000">one_input_prompt</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">PromptTemplate</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">input_variables</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;adjective&#34;</span><span style="color:#000;font-weight:bold">],</span> <span style="color:#000">template</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;Tell me a </span><span style="color:#4e9a06">{adjective}</span><span style="color:#4e9a06"> joke.&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">one_input_prompt</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">format</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">adjective</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;funny&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># -&gt; &#34;Tell me a funny joke.&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># 多个输入</span>
</span></span><span style="display:flex;"><span><span style="color:#000">multiple_input_prompt</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">PromptTemplate</span><span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">input_variables</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;adjective&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;content&#34;</span><span style="color:#000;font-weight:bold">],</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#000">template</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;Tell me a </span><span style="color:#4e9a06">{adjective}</span><span style="color:#4e9a06"> joke about </span><span style="color:#4e9a06">{content}</span><span style="color:#4e9a06">.&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">multiple_input_prompt</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">format</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">adjective</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;funny&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">content</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;chickens&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># -&gt; &#34;Tell me a funny joke about chickens.&#34;</span>
</span></span></code></pre></div><hr>
<h4 id="43-从langchainhubhttpsgithubcomhwchase17langchain-hub获取现成的promtps">4.3 从<a href="https://github.com/hwchase17/langchain-hub">LangChainHub</a>获取现成的promtps：</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">langchain.prompts</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">load_prompt</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">prompt</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">load_prompt</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;lc://prompts/conversation/prompt.json&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">prompt</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">format</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">history</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#204a87">input</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;What is 1 + 1?&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div><hr>
<h4 id="44-fewshot-prompt-template">4.4 fewshot prompt template</h4>
<p>Few shot examples 会在prompt中添加示例，可以用来帮助语言模型生成更好的响应。如果要使用fewshot，需要引入<code>FewShotPromptTemplate</code>。下面是一个示例：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">langchain</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">PromptTemplate</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">FewShotPromptTemplate</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># First, create the list of few shot examples.</span>
</span></span><span style="display:flex;"><span><span style="color:#000">examples</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">[</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">{</span><span style="color:#4e9a06">&#34;word&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;happy&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;antonym&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;sad&#34;</span><span style="color:#000;font-weight:bold">},</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">{</span><span style="color:#4e9a06">&#34;word&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;tall&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;antonym&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;short&#34;</span><span style="color:#000;font-weight:bold">},</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Next, we specify the template to format the examples we have provided.</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># We use the `PromptTemplate` class for this.</span>
</span></span><span style="display:flex;"><span><span style="color:#000">example_formatter_template</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">Word: </span><span style="color:#4e9a06">{word}</span><span style="color:#4e9a06">
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">Antonym: </span><span style="color:#4e9a06">{antonym}</span><span style="color:#4e9a06">\n</span><span style="color:#4e9a06">
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#000">example_prompt</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">PromptTemplate</span><span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">input_variables</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;word&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;antonym&#34;</span><span style="color:#000;font-weight:bold">],</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">template</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">example_formatter_template</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Finally, we create the `FewShotPromptTemplate` object.</span>
</span></span><span style="display:flex;"><span><span style="color:#000">few_shot_prompt</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">FewShotPromptTemplate</span><span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># These are the examples we want to insert into the prompt.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">examples</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">examples</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># This is how we want to format the examples when we insert them into the prompt.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">example_prompt</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">example_prompt</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># The prefix is some text that goes before the examples in the prompt.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># Usually, this consists of intructions.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">prefix</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;Give the antonym of every input&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># The suffix is some text that goes after the examples in the prompt.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># Usually, this is where the user input will go</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">suffix</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;Word: </span><span style="color:#4e9a06">{input}</span><span style="color:#4e9a06">\n</span><span style="color:#4e9a06">Antonym:&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># The input variables are the variables that the overall prompt expects.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">input_variables</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;input&#34;</span><span style="color:#000;font-weight:bold">],</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># The example_separator is the string we will use to join the prefix, examples, and suffix together with.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">example_separator</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">\n\n</span><span style="color:#4e9a06">&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># We can now generate a prompt using the `format` method.</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">few_shot_prompt</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">format</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">input</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;big&#34;</span><span style="color:#000;font-weight:bold">))</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># -&gt; Give the antonym of every input</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># -&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># -&gt; Word: happy</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># -&gt; Antonym: sad</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># -&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># -&gt; Word: tall</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># -&gt; Antonym: short</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># -&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># -&gt; Word: big</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># -&gt; Antonym:</span>
</span></span></code></pre></div><p>对于fewshot examples，工具提供了selector来选择使用哪些examples，我们可以使用<code>SemanticSimilarityExampleSelector</code>（从examples中选择语义相似度最高的）：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">langchain.prompts.example_selector</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">SemanticSimilarityExampleSelector</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">langchain.vectorstores</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">Chroma</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">langchain.embeddings</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">OpenAIEmbeddings</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">example_selector</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">SemanticSimilarityExampleSelector</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">from_examples</span><span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># This is the list of examples available to select from.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">examples</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># This is the embedding class used to produce embeddings which are used to measure semantic similarity.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">OpenAIEmbeddings</span><span style="color:#000;font-weight:bold">(),</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># This is the VectorStore class that is used to store the embeddings and do a similarity search over.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">Chroma</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># This is the number of examples to produce.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">k</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Select the most similar example to the input.</span>
</span></span><span style="display:flex;"><span><span style="color:#000">question</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;Who was the father of Mary Ball Washington?&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#000">selected_examples</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">example_selector</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">select_examples</span><span style="color:#000;font-weight:bold">({</span><span style="color:#4e9a06">&#34;question&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">question</span><span style="color:#000;font-weight:bold">})</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">f</span><span style="color:#4e9a06">&#34;Examples most similar to the input: </span><span style="color:#4e9a06">{</span><span style="color:#000">question</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">example</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#000">selected_examples</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">\n</span><span style="color:#4e9a06">&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#000">k</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">v</span> <span style="color:#204a87;font-weight:bold">in</span> <span style="color:#000">example</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">items</span><span style="color:#000;font-weight:bold">():</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">f</span><span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">{</span><span style="color:#000">k</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">: </span><span style="color:#4e9a06">{</span><span style="color:#000">v</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div><pre tabindex="0"><code>Running Chroma using direct local API.
Using DuckDB in-memory for database. Data will be transient.
Examples most similar to the input: Who was the father of Mary Ball Washington?


question: Who was the maternal grandfather of George Washington?
answer: 
Are follow up questions needed here: Yes.
Follow up: Who was the mother of George Washington?
Intermediate answer: The mother of George Washington was Mary Ball Washington.
Follow up: Who was the father of Mary Ball Washington?
Intermediate answer: The father of Mary Ball Washington was Joseph Ball.
So the final answer is: Joseph Ball
</code></pre><p>将selector选中的exapmle送入fewshot template：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000">prompt</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">FewShotPromptTemplate</span><span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">example_selector</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">example_selector</span><span style="color:#000;font-weight:bold">,</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#000">example_prompt</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">example_prompt</span><span style="color:#000;font-weight:bold">,</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#000">suffix</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;Question: </span><span style="color:#4e9a06">{input}</span><span style="color:#4e9a06">&#34;</span><span style="color:#000;font-weight:bold">,</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#000">input_variables</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;input&#34;</span><span style="color:#000;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">prompt</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">format</span><span style="color:#000;font-weight:bold">(</span><span style="color:#204a87">input</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;Who was the father of Mary Ball Washington?&#34;</span><span style="color:#000;font-weight:bold">))</span>
</span></span></code></pre></div><hr>
<h4 id="45-partial-prompt-template">4.5 partial prompt template</h4>
<p>想要部分提示模板的一个常见用例是，如果您先获得一些变量。例如，假设您有一个需要两个变量 foo 和 baz 的提示模板。如果您在链的早期获得 foo 值，但在稍后获得 baz 值，那么等待两个变量都位于同一位置以将它们传递给提示模板可能会很烦人。相反，您可以使用 foo 值部分提示模板，然后传递部分提示模板并使用它。下面是一个这样做的例子：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">langchain.prompts</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">PromptTemplate</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">prompt</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">PromptTemplate</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">template</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">{foo}{bar}</span><span style="color:#4e9a06">&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">input_variables</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;foo&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;bar&#34;</span><span style="color:#000;font-weight:bold">])</span>
</span></span><span style="display:flex;"><span><span style="color:#000">partial_prompt</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">prompt</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">partial</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">foo</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;foo&#34;</span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">partial_prompt</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">format</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">bar</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;baz&#34;</span><span style="color:#000;font-weight:bold">))</span>
</span></span></code></pre></div><pre tabindex="0"><code>foobaz
</code></pre><p>应用示例：
这个用例是当你有一个你知道你总是想以通用方式获取的变量时。一个典型的例子是日期或时间。假设您有一个提示，您总是希望获得当前日期。您不能在提示中对其进行硬编码，并且将其与其他输入变量一起传递有点烦人。在这种情况下，能够使用始终返回当前日期的函数来部分提示是非常方便的。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">datetime</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">datetime</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">_get_datetime</span><span style="color:#000;font-weight:bold">():</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">now</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">datetime</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">now</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">now</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">strftime</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;%m/</span><span style="color:#4e9a06">%d</span><span style="color:#4e9a06">/%Y, %H:%M:%S&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">prompt</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">PromptTemplate</span><span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">template</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;Tell me a </span><span style="color:#4e9a06">{adjective}</span><span style="color:#4e9a06"> joke about the day </span><span style="color:#4e9a06">{date}</span><span style="color:#4e9a06">&#34;</span><span style="color:#000;font-weight:bold">,</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#000">input_variables</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;adjective&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;date&#34;</span><span style="color:#000;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#000">partial_prompt</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">prompt</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">partial</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">date</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">_get_datetime</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">partial_prompt</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">format</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">adjective</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;funny&#34;</span><span style="color:#000;font-weight:bold">))</span>
</span></span></code></pre></div><pre tabindex="0"><code>Tell me a funny joke about the day 02/27/2023, 22:15:16
</code></pre><p>更简便的写法：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000">prompt</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">PromptTemplate</span><span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">template</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;Tell me a </span><span style="color:#4e9a06">{adjective}</span><span style="color:#4e9a06"> joke about the day </span><span style="color:#4e9a06">{date}</span><span style="color:#4e9a06">&#34;</span><span style="color:#000;font-weight:bold">,</span> 
</span></span><span style="display:flex;"><span>    <span style="color:#000">input_variables</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;adjective&#34;</span><span style="color:#000;font-weight:bold">],</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">partial_variables</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">{</span><span style="color:#4e9a06">&#34;date&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">_get_datetime</span><span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">);</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">prompt</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">format</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">adjective</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;funny&#34;</span><span style="color:#000;font-weight:bold">))</span>
</span></span></code></pre></div><hr>
<h4 id="46-序列化我们的prompts">4.6 序列化我们的prompts</h4>
<p>除了使用python code储存我们的prompts，我们还可以将prompts存入文件，langchain提供了从JSON或YAML中读取prompts的能力。langchain支持在一个文件中指定所有内容，或者将不同的组件（模板、示例等）存储在不同的文件中并引用它们，如果想使用这个能力，需要引入：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># All prompts are loaded through the `load_prompt` function.</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">langchain.prompts</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">load_prompt</span>
</span></span></code></pre></div><p>简单举例，如果想在一个JSON中读取一个简单的prompt template：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">&#34;_type&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;prompt&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">&#34;input_variables&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;adjective&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#4e9a06">&#34;content&#34;</span><span style="color:#000;font-weight:bold">],</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">&#34;template&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#4e9a06">&#34;Tell me a {adjective} joke about {content}.&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">}</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000">prompt</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">load_prompt</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;simple_prompt.json&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">print</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">prompt</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">format</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">adjective</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;funny&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">content</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;chickens&#34;</span><span style="color:#000;font-weight:bold">))</span>
</span></span></code></pre></div><p>同时还支持FewShotExample存入JSON等，具体可以见：<a href="https://python.langchain.com/en/latest/modules/prompts/prompt_templates/examples/prompt_serialization.html">网页</a></p>
<hr>
<h4 id="47-output-parsers">4.7 Output Parsers</h4>
<p>OutputParsers主要是让你结构化大模型的返回。使用OutputParsers主要有两个方法：</p>
<ul>
<li><code>get_format_instructions() -&gt; str</code>: 一种返回字符串的方法，该字符串包含有关如何格式化语言模型输出的说明。</li>
<li><code>parse(str) -&gt; Any</code>: 一种接收字符串（假设是语言模型的响应）并将其解析为某种结构的方法。</li>
<li><code>parse_with_prompt(str) -&gt; Any</code>: 一种接受字符串（假设是来自语言模型的响应）和提示（假设生成此类响应的提示）并将其解析为某种结构的方法。</li>
</ul>
<p>简单举例：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">langchain.prompts</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">PromptTemplate</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">ChatPromptTemplate</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">HumanMessagePromptTemplate</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">langchain.llms</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">OpenAI</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">langchain.chat_models</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">ChatOpenAI</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">langchain.output_parsers</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">PydanticOutputParser</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">pydantic</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">BaseModel</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">Field</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">validator</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">typing</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">List</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000">model_name</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#39;text-davinci-003&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#000">temperature</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">0.0</span>
</span></span><span style="display:flex;"><span><span style="color:#000">model</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">OpenAI</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">model_name</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">model_name</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">temperature</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">temperature</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Define your desired data structure.</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">class</span> <span style="color:#000">Joke</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">BaseModel</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">setup</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87">str</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Field</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">description</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;question to set up a joke&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">punchline</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#204a87">str</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Field</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">description</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;answer to resolve the joke&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#8f5902;font-style:italic"># You can add custom validation logic easily with Pydantic.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#5c35cc;font-weight:bold">@validator</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#39;setup&#39;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">def</span> <span style="color:#000">question_ends_with_question_mark</span><span style="color:#000;font-weight:bold">(</span><span style="color:#3465a4">cls</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">field</span><span style="color:#000;font-weight:bold">):</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">field</span><span style="color:#000;font-weight:bold">[</span><span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#0000cf;font-weight:bold">1</span><span style="color:#000;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">!=</span> <span style="color:#4e9a06">&#39;?&#39;</span><span style="color:#000;font-weight:bold">:</span>
</span></span><span style="display:flex;"><span>            <span style="color:#204a87;font-weight:bold">raise</span> <span style="color:#c00;font-weight:bold">ValueError</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;Badly formed question!&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#204a87;font-weight:bold">return</span> <span style="color:#000">field</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Set up a parser + inject instructions into the prompt template.</span>
</span></span><span style="display:flex;"><span><span style="color:#000">parser</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">PydanticOutputParser</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">pydantic_object</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">Joke</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000">prompt</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">PromptTemplate</span><span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">template</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;Answer the user query.</span><span style="color:#4e9a06">\n</span><span style="color:#4e9a06">{format_instructions}</span><span style="color:#4e9a06">\n</span><span style="color:#4e9a06">{query}</span><span style="color:#4e9a06">\n</span><span style="color:#4e9a06">&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">input_variables</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;query&#34;</span><span style="color:#000;font-weight:bold">],</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">partial_variables</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">{</span><span style="color:#4e9a06">&#34;format_instructions&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">parser</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">get_format_instructions</span><span style="color:#000;font-weight:bold">()}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># And a query intented to prompt a language model to populate the data structure.</span>
</span></span><span style="display:flex;"><span><span style="color:#000">joke_query</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;Tell me a joke.&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#000">_input</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">prompt</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">format_prompt</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">query</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000">joke_query</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000">output</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">model</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">_input</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">to_string</span><span style="color:#000;font-weight:bold">())</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000">parser</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">parse</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">output</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#a40000">Joke(setup=&#39;Why</span> <span style="color:#a40000">did</span> <span style="color:#a40000">the</span> <span style="color:#a40000">chicken</span> <span style="color:#a40000">cross</span> <span style="color:#a40000">the</span> <span style="color:#a40000">road?&#39;,</span> <span style="color:#a40000">punchline=&#39;To</span> <span style="color:#a40000">get</span> <span style="color:#a40000">to</span> <span style="color:#a40000">the</span> <span style="color:#a40000">other</span> <span style="color:#a40000">side!&#39;)</span>
</span></span></code></pre></div><p>另外一种输出约定方法： CommaSeparatedListOutputParser，举例：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">langchain.output_parsers</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">CommaSeparatedListOutputParser</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">langchain.prompts</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">PromptTemplate</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">ChatPromptTemplate</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">HumanMessagePromptTemplate</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">langchain.llms</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">OpenAI</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">langchain.chat_models</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">ChatOpenAI</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">output_parser</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">CommaSeparatedListOutputParser</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">format_instructions</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">output_parser</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">get_format_instructions</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span><span style="color:#000">prompt</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">PromptTemplate</span><span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">template</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;List five </span><span style="color:#4e9a06">{subject}</span><span style="color:#4e9a06">.</span><span style="color:#4e9a06">\n</span><span style="color:#4e9a06">{format_instructions}</span><span style="color:#4e9a06">&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">input_variables</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;subject&#34;</span><span style="color:#000;font-weight:bold">],</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">partial_variables</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">{</span><span style="color:#4e9a06">&#34;format_instructions&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">format_instructions</span><span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">model</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">OpenAI</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">temperature</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">_input</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">prompt</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">format</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">subject</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;ice cream flavors&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">output</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">model</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">_input</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">output_parser</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">parse</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">output</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div><p>输出：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">[</span><span style="color:#a40000">&#39;Vanilla&#39;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span> <span style="color:#a40000">&#39;Chocolate&#39;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span> <span style="color:#a40000">&#39;Strawberry&#39;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span> <span style="color:#a40000">&#39;Mint</span> <span style="color:#a40000">Chocolate</span> <span style="color:#a40000">Chip&#39;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span> <span style="color:#a40000">&#39;Cookies</span> <span style="color:#a40000">and</span> <span style="color:#a40000">Cream&#39;</span><span style="color:#000;font-weight:bold">]</span>
</span></span></code></pre></div><p>一个更加简单的OutputParser：# Structured Output Parser，使用实例：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">langchain.output_parsers</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">StructuredOutputParser</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">ResponseSchema</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">langchain.prompts</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">PromptTemplate</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">ChatPromptTemplate</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">HumanMessagePromptTemplate</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">langchain.llms</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">OpenAI</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">from</span> <span style="color:#000">langchain.chat_models</span> <span style="color:#204a87;font-weight:bold">import</span> <span style="color:#000">ChatOpenAI</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">response_schemas</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000;font-weight:bold">[</span> <span style="color:#8f5902;font-style:italic"># 输出规定</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">ResponseSchema</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">name</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;answer&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">description</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;answer to the user&#39;s question&#34;</span><span style="color:#000;font-weight:bold">),</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">ResponseSchema</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">name</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;source&#34;</span><span style="color:#000;font-weight:bold">,</span> <span style="color:#000">description</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;source used to answer the user&#39;s question, should be a website.&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span><span style="color:#000">output_parser</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">StructuredOutputParser</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">from_response_schemas</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">response_schemas</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">format_instructions</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">output_parser</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">get_format_instructions</span><span style="color:#000;font-weight:bold">()</span>
</span></span><span style="display:flex;"><span><span style="color:#000">prompt</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">PromptTemplate</span><span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">template</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;answer the users question as best as possible.</span><span style="color:#4e9a06">\n</span><span style="color:#4e9a06">{format_instructions}</span><span style="color:#4e9a06">\n</span><span style="color:#4e9a06">{question}</span><span style="color:#4e9a06">&#34;</span><span style="color:#000;font-weight:bold">,</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">input_variables</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;question&#34;</span><span style="color:#000;font-weight:bold">],</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">partial_variables</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">{</span><span style="color:#4e9a06">&#34;format_instructions&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">format_instructions</span><span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">model</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">OpenAI</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">temperature</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">_input</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">prompt</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">format_prompt</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">question</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;what&#39;s the capital of france&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">output</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">model</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">_input</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">to_string</span><span style="color:#000;font-weight:bold">())</span>
</span></span><span style="display:flex;"><span><span style="color:#000">output_parser</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">parse</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">output</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">{</span><span style="color:#a40000">&#39;answer&#39;:</span> <span style="color:#a40000">&#39;Paris&#39;,</span> <span style="color:#a40000">&#39;source&#39;:</span> <span style="color:#a40000">&#39;https:</span><span style="color:#8f5902;font-style:italic">//en.wikipedia.org/wiki/Paris&#39;}
</span></span></span></code></pre></div><p>下面是使用chatmodel的示例：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#000">chat_model</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">ChatOpenAI</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">temperature</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">0</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">prompt</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">ChatPromptTemplate</span><span style="color:#000;font-weight:bold">(</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">messages</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">[</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000">HumanMessagePromptTemplate</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">from_template</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;answer the users question as best as possible.</span><span style="color:#4e9a06">\n</span><span style="color:#4e9a06">{format_instructions}</span><span style="color:#4e9a06">\n</span><span style="color:#4e9a06">{question}</span><span style="color:#4e9a06">&#34;</span><span style="color:#000;font-weight:bold">)</span>  
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">],</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">input_variables</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">[</span><span style="color:#4e9a06">&#34;question&#34;</span><span style="color:#000;font-weight:bold">],</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">partial_variables</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#000;font-weight:bold">{</span><span style="color:#4e9a06">&#34;format_instructions&#34;</span><span style="color:#000;font-weight:bold">:</span> <span style="color:#000">format_instructions</span><span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">_input</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">prompt</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">format_prompt</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">question</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;what&#39;s the capital of france&#34;</span><span style="color:#000;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">output</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">chat_model</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">_input</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">to_messages</span><span style="color:#000;font-weight:bold">())</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">output_parser</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">parse</span><span style="color:#000;font-weight:bold">(</span><span style="color:#000">output</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">content</span><span style="color:#000;font-weight:bold">)</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">{</span><span style="color:#a40000">&#39;answer&#39;:</span> <span style="color:#a40000">&#39;Paris&#39;,</span> <span style="color:#a40000">&#39;source&#39;:</span> <span style="color:#a40000">&#39;https:</span><span style="color:#8f5902;font-style:italic">//en.wikipedia.org/wiki/Paris&#39;}
</span></span></span></code></pre></div>

	</div>
	
      </div>
	  	<div class="disqus markdown">
		<div id="disqus_thread"></div>
<script type="text/javascript">

(function() {
    
    
    
    

    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    var disqus_shortname = 'rainpot';
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

		</div>
      <div class="container">
  <span class="row justify-content-center meta" id="footer">
    Copyright ©
      2023
    RainPot
  </span>
  <script defer src="/js/custom.js"></script>
  

</div>

    </div>
  </div>
</div>

  </body>

</html>
